#include <Keypad.h>

const byte ROWS = 4, COLS = 4;
char keys[ROWS][COLS] = {
  {'1','2','3','A'},  
  {'4','5','6','B'},   
  {'7','8','9','C'},  
  {'*','0','#','D'}    
};

byte rowPins[ROWS] = {9, 8, 7, 6};
byte colPins[COLS] = {5, 4, 3, 2};

Keypad keypad = Keypad(makeKeymap(keys), rowPins, colPins, ROWS, COLS);

String num1 = "", num2 = "";
char op = '\0';
bool enteringSecondNum = false;

void setup() {
  Serial.begin(9600);
  Serial.println("Calculator Ready!");
  Serial.println("Use A=+, B=-, C=*, D=/, # for =, * to clear");
}

void loop() {
  char key = keypad.getKey();
  if (!key) return;

  if (key >= '0' && key <= '9') {
    if (!enteringSecondNum) num1 += key;
    else num2 += key;
    Serial.print(key);
  }
  else if (key=='A' || key=='B' || key=='C' || key=='D') {
    if (num1 != "") {
      if (key=='A') op = '+';
      if (key=='B') op = '-';
      if (key=='C') op = '*';
      if (key=='D') op = '/';
      enteringSecondNum = true;
      Serial.print(" ");
      Serial.print(op);
      Serial.print(" ");
    }
  }
  else if (key == '#') {
    if (num1 != "" && num2 != "" && op != '\0') {
      long n1 = num1.toInt();
      long n2 = num2.toInt();
      long result = 0;
      bool valid = true;
      if (op == '+') result = n1 + n2;
      else if (op == '-') result = n1 - n2;
      else if (op == '*') result = n1 * n2;
      else if (op == '/') {
        if (n2 != 0) result = n1 / n2;
        else { Serial.println("\nError: Divide by zero!"); valid = false; }
      }
      if (valid) {
        Serial.print(" = ");
        Serial.println(result);
      }
    }
    num1 = "";
    num2 = "";
    op = '\0';
    enteringSecondNum = false;
  }
  else if (key == '*') {
    num1 = "";
    num2 = "";
    op = '\0';
    enteringSecondNum = false;
    Serial.println("\nCleared");
  }
}
